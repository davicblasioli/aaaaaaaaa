CREATE TABLE usuarios (
	id_usuario integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	nome varchar(255) NOT NULL,
	email varchar(255) NOT NULL,
	senha varchar(255) NOT NULL,
	telefone varchar(20) NOT NULL,
	data_nascimento date NOT NULL,
	multa numeric(10,2),
	cargo varchar(255) NOT NULL,
	status varchar(255) NOT NULL
);

ALTER TABLE USUARIOS ALTER COLUMN DATA_NASCIMENTO TYPE DATE;


CREATE TABLE livros (
	id_livro integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	titulo varchar(255) NOT NULL,
	autor varchar(255) NOT NULL,
	data_publicacao date NOT NULL,
	ISBN varchar(255) NOT NULL,
	descricao varchar(255) NOT NULL,
	quantidade numeric(5),
	categoria varchar(255) NOT NULL,
	status varchar(255) NOT NULL
);

-- 1. Adiciona nova coluna do tipo BLOB texto
ALTER TABLE LIVROS ADD descricao_blob BLOB SUB_TYPE 1;

-- 2. Copia os dados da coluna antiga para a nova (convertendo texto)
UPDATE LIVROS SET descricao_blob = descricao;

-- 3. Remove a coluna antiga
ALTER TABLE LIVROS DROP descricao;

-- 4. Renomeia a nova coluna para o nome original
ALTER TABLE LIVROS ALTER COLUMN descricao_blob TO descricao;


CREATE TABLE configmulta(
	id_config integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	valorfixo NUMERIC(10,2) NOT NULL,
	acrescimo NUMERIC(10,2) NOT NULL,
	ano date NOT NULL
);

CREATE TABLE multas(
	id_multa integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	valor NUMERIC(10,2) NOT NULL,
	data_lancamento date NOT NULL,
	id_usuario integer NOT NULL,
	id_config integer NOT NULL,
	FOREIGN KEY (id_usuario) REFERENCES usuarios (id_usuario) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (id_config) REFERENCES configmulta (id_config) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE emprestimos(
	id_emprestimo integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	titulo varchar(255) NOT NULL,
	data_emprestimo date NOT NULL,
	data_devolucao date NOT NULL,
	nome_usuario varchar(255) NOT NULL,
	id_usuario integer,
	id_livro integer,
	FOREIGN KEY (id_livro) REFERENCES livros (id_livro) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (id_usuario) REFERENCES usuarios (id_usuario) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE itens_emprestimo (
	id_item integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	titulo varchar(255) NOT NULL,
	emprestimos varchar(255) NOT NULL,
	id_emprestimo integer,
	FOREIGN KEY (id_emprestimo) REFERENCES emprestimos (id_emprestimo) ON DELETE CASCADE ON UPDATE CASCADE
);

ALTER TABLE usuarios 
ALTER COLUMN status DROP NOT NULL;

ALTER TABLE usuarios ALTER COLUMN status SET DEFAULT 'Ativo';
ALTER TABLE usuarios ALTER COLUMN tentativas_erro SET DEFAULT 0;
ALTER TABLE usuarios ALTER COLUMN cargo SET DEFAULT 'Cliente';
ALTER TABLE usuarios ALTER COLUMN multa SET DEFAULT 0;

ALTER TABLE USUARIOS ADD tentativas_erro integer;
UPDATE USUARIOS SET tentativas_erro=0;
UPDATE USUARIOS SET cargo='Cliente';

ALTER TABLE livros ALTER COLUMN status SET DEFAULT 'Disponível'

INSERT INTO usuarios(nome, email, senha, telefone, DATA_NASCIMENTO, multa, cargo, status)
values('paulinho', 'paulinho@gmail.com', 'Paulo@2000', '999999999', '2020-02-20', 0, 'Cliente', 'Ativo') 

INSERT INTO usuarios(nome, email, senha, telefone, DATA_NASCIMENTO, multa, cargo, status)
values('aaaaa', 'aaaaaa@gmail.com', 'Aaaa@2000', '899999999', '2020-02-20', 0, 'Cliente', 'Ativo') 

INSERT INTO usuarios(nome, email, senha, telefone, DATA_NASCIMENTO, multa, cargo, status)
values('jorge', 'jorge@gmail.com', 'Jorge@2000', '799999999', '2020-02-20', 0, 'Cliente', 'Ativo')

INSERT INTO livros (titulo, autor, data_publicacao, ISBN, descricao, quantidade, categoria)
VALUES (
    'O Pequeno',
    'Antoine de Saint-Exupéry',
    '1943-04-06',
    '978-3-16-148410-0',
    'Uma amizade e amor.',
    10, 
    'Adulto', 
);

ALTER TABLE EMPRESTIMOS DROP nome_usuario;
ALTER TABLE EMPRESTIMOS DROP titulo;
ALTER TABLE LIVROS DROP status;
ALTER TABLE LIVROS ADD 	quantidade numeric(5);



reserva-emprestimo
id reserva
id usuarui
id_livro
data_reserva


1 2 

SELECT * FROM LIVROS l 

ALTER TABLE emprestimos ADD data_reserva DATE;
ALTER TABLE emprestimos ADD data_emprestimo DATE;
ALTER TABLE emprestimos ADD data_devolvida DATE;
ALTER TABLE emprestimos ADD data_devolucao DATE;
ALTER TABLE emprestimos ADD status integer;
ALTER TABLE EMPRESTIMOS DROP data_emprestimo;
ALTER TABLE EMPRESTIMOS DROP data_devolucao;
ALTER TABLE EMPRESTIMOS DROP data_devolvida;

